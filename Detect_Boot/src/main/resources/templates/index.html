<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>부유물 탐지 시스템</title>
</head>
<body>
<h1>부유물 탐지 시스템</h1>
<form method="post" enctype="multipart/form-data" id="fileUploadForm">
    <p>데이터 : <input type="text" name="message" value="test hello"></p>
    <p>파일 : <input type="file" name="file"></p>
    <input type="button" value=" 비동기 요청 ">
</form>
<div id="result">객체탐지결과 및 분석</div>
<a href="ai">실시간 스트리밍</a>

<script type="text/javascript">
    var button = document.querySelector("input[type=button]");

    button.addEventListener("click", function() {
        var form = document.getElementById("fileUploadForm");
        var form_data = new FormData(form);
        button.disabled = true;

        var xhr = new XMLHttpRequest();

        xhr.open("POST", "http://localhost:5050/java_service", true);

        xhr.onload = function() {
            if(xhr.status >= 200 && xhr.status < 300) {
                var response = JSON.parse(xhr.responseText);
                var resultDiv = document.getElementById("result");
                resultDiv.innerHTML = response.message + "<br>";

                // 이미지 처리
                if (response.image && response.image !== 'undefined' && response.image !== null) {
                    var img_src = "data:image/jpeg;base64," + response.image;
                    var img = document.createElement("img");
                    img.src = img_src;
                    img.alt = "탐지 결과 이미지";
                    img.style.maxWidth = "100%";
                    resultDiv.appendChild(img);
                } else {
                    console.error("이미지 데이터를 처리할 수 없습니다.");
                    alert("이미지 데이터를 처리할 수 없습니다.");
                }

                // 그래프 처리
                if (response.plot && response.plot !== 'undefined' && response.plot !== null) {
                    var graph_src = "data:image/png;base64," + response.plot;
                    var graph = document.createElement("img");
                    graph.src = graph_src;
                    graph.alt = "탐지 결과 그래프";
                    graph.style.maxWidth = "100%";
                    resultDiv.appendChild(graph);
                } else {
                    console.error("그래프 데이터를 처리할 수 없습니다.");
                    alert("그래프 데이터를 처리할 수 없습니다.");
                }

            } else {
                console.error("ERROR: " + xhr.statusText);
                alert("fail " + xhr.statusText);
                button.disabled = false;
            }
        }

        xhr.onerror = function() {
            console.error("ERROR: " + xhr.statusText);
            alert("fail " + xhr.statusText);
            button.disabled = false;
        }
        xhr.send(form_data);
    });
</script>
</body>
</html>
