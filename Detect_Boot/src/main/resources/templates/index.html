<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>부유물 탐지 시스템</title>
</head>
<body>
<h1>부유물 탐지 시스템</h1>
<form method="post" enctype="multipart/form-data" id="fileUploadForm">
    <p>데이터 : <input type="text" name="message" value="test hello"></p>
    <p>파일 : <input type="file" name="file"></p>
    <input type="button" value=" 비동기 요청 ">
</form>
<div id="result1">객체탐지결과</div>
<div id="result2">분석결과</div>
<a href="ai">실시간 스트리밍</a>
<script type="text/javascript">
    var button = document.querySelector("input[type=button]");

    button.addEventListener("click", function () {
        var form = document.getElementById("fileUploadForm");
        var form_data = new FormData(form);
        button.disabled = true;

        var xhr = new XMLHttpRequest();

        xhr.open("POST", "http://localhost:5050/java_service", true);

        xhr.onload = function () {
            if (xhr.status >= 200 && xhr.status < 300) {
                var response = JSON.parse(xhr.responseText);

                // 객체 탐지 결과 이미지
                var resultDiv = document.getElementById("result1");
                resultDiv.innerHTML = response.message + "<br>";
                var img_src = "data:image/png;base64," + response.image;
                var img = document.createElement("img");
                img.src = img_src;
                resultDiv.appendChild(img);

                // 분석 결과 그래프
                var plotDiv = document.getElementById("result2");
                var plot_src = "data:image/png;base64," + response.plot;
                var plot = document.createElement("img");
                plot.src = plot_src;
                plotDiv.innerHTML = ""; // 이전 내용 초기화
                plotDiv.appendChild(plot);

                button.disabled = false;
            } else {
                console.error("ERROR: " + xhr.statusText);
                alert("fail " + xhr.statusText);
                button.disabled = false;
            }
        };

        xhr.onerror = function () {
            console.error("ERROR: " + xhr.statusText);
            alert("fail " + xhr.statusText);
            button.disabled = false;
        };
        xhr.send(form_data);
    });
</script>
</body>
</html>
